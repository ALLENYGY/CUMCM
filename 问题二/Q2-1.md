# 问题二

## 思路分析

- 分两步研究本题，首先研究各蔬菜品类的销售总量与成本加成定价的关系，对每个品类进行ADF检验并建立VAR向量自回归模型；然后研究蔬菜品类未来一周的补货总量与定价的关系，对每个品类进行因果检验然后通过带约束的线性规划模型求得多元回归模型，通过时间序列模型预测批发价格，最后分析公式求得最优利润。

## 模型建立

### 数据预处理与清洗

在解决问题二之前，首先进行了数据预处理和清洗，以确保模型的可靠性。首先，我们计算了每个蔬菜品类的利润，这是销售总额与成本加成之差。然后，我们计算了成本加成率，这是成本加成与销售总额之比。这两个指标为我们后续的分析提供了重要数据。

在数据清洗方面，我们采用了3σ（三倍标准差）异常值处理方法，以排除异常值对分析结果的影响。

### 各蔬菜品类的销售总量与成本加成定价的关系

为了分析各蔬菜品类的销售总量与成本加成定价之间的关系，我们首先对每个品类的销售数据进行了单独的单位根检验（ADF检验），以确认时间序列的平稳性。平稳性是建立时间序列模型的前提，确保我们得到可靠的结果。接着，我们通过模型选择方法寻找最优的滞后阶数，这是向量自回归（VAR）模型建立的关键参数。

对于每个蔬菜品类，我们建立了单独的VAR向量自回归模型，该模型描述了销售总量与成本加成定价之间的关系。这些模型使我们能够了解各品类的销售特性和价格变化之间的动态关系。同时，我们还进行了VAR模型的稳定性检验，以确保模型的可靠性和准确性。

### 关于蔬菜品类未来一周的补货总量与定价的关系

#### 因果检验

在研究蔬菜品类未来一周的补货总量与定价之间的关系时，我们首先进行了因果检验，以确定是否存在因果关系。为了进行因果检验，我们采取了以下步骤：

1. 首先，我们进行了ADF检验，以确认各时间序列均是平稳序列，避免伪回归的问题。

2. 使用之前针对每个品类的最优滞后阶数，这是通过对FPE（Final Prediction Error）、AIC（Akaike Information Criterion）、SC（Schwarz Criterion）、HQ（Hannan-Quinn Criterion）等指标的评估得出的。

3. 我们还进行了格兰杰因果检验，以验证变量之间是否存在因果关系。特别是，我们探究了销量（千克）是否可以引起销售单价（元/千克）的变化。

#### 建立回归模型

在确认了因果关系后，我们尝试建立了多元线性回归模型，用于描述补货总量与定价之间的关系。我们的模型表达如下：

$$售价 = a \cdot 销售量 + b \cdot 批发价 + c \space\space\space\space\space\space\space\space(1)$$

在建立模型后，我们进行了模型评估。F检验的结果表明，模型的P值显著，拒绝了回归系数为0的假设，这表明多元线性回归模型基本满足要求。此外，我们还对变量共线性进行了分析，发现VIF（方差膨胀因子）均严格小于5，没有多重共线性问题，因此模型构建良好。

不过，我们意识到使用最小二乘法建立的多元线性回归模型中的参数未被约束，这可能不利于后续最优利润的求解。为了改进模型，我们决定使用线性规划模型对参数进行约束。

#### 线性规划模型

我们使用带约束的线性规划模型，以求解多元线性回归模型的最优参数。通过线性规划，我们得到了具有约束条件的最优参数，这使得模型更加稳健。通过计算$R^2$（决定系数），我们发现所有品类的$R^2$普遍在0.9以上，表明模型的拟合效果良好。

### 时间序列ARIMA预测批发价

为了进一步提高模型的准确性，我们使用时间序列分析方法（ARIMA模型）来预测蔬菜的批发价格。ARIMA模型是一种强大的工具，可以捕捉时间序列数据的趋势和季节性。在建立ARIMA模型时，我们采取以下步骤：

1. 查看差分前后数据的对比图，分析上下波动幅度。同时，通过自相关分析，根据截尾情况估算其p和q值。

2. ARIMA模型要求模型残差是白噪声，即没有任何模式或趋势。为此，我们对模型的白噪声进行了检验，通过Q统计量的P值（P>0.05）来验证模型的白噪声性质。此外，我们还使用AIC和BIC值来评估模型的拟合优度，这两个指标的较低值表明模型适用性较好。

### 未来一周定价策略与日补货

总量

最终，我们综合考虑了模型的各个方面，得出了蔬菜品类未来一周（2023年7月1日至7月7日）的日补货总量和定价策略，以使商超收益最大化。我们利用以下利润公式来指导决策：

$$利润 = 销量 \cdot (售价 - 批发价)$$

联立公式（1）和利润公式，我们得到了一个一元二次方程：

$$利润 = ax^2 + (b-1)px + cx \space\space\space\space\space\space\space\space(满足a < 0且b > 1)$$

通过分析这个方程，我们发现最大利润发生在使其导数等于零的点，即：

$$x = \frac{1-b}{2a}p$$

通过时间序列模型得到预测批发价格即可得到最优利润时的销售价格
