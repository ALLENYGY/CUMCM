# 问题二的模型建立分析与求解

问题 2 考虑商超以品类为单位做补货计划，请分析各蔬菜品类的销售总量与成本加成 请分析各蔬菜品类的销售总量与成本加成定价的关系，并给出各蔬菜品类未来一周 定价的关系，并给出各蔬菜品类未来一周 (2023 年 7月 1-7日)的日补货总量和定价策略，
使得商超收益最大。

## 思路分析

- 分两步研究本题，首先研究各蔬菜品类的销售总量与成本加成定价的关系，对每个品类进行ADF检验并建立VAR向量自回归模型；然后研究蔬菜品类未来一周的补货总量与定价的关系，对每个品类进行因果检验然后通过带约束的线性规划模型求得多元回归模型，通过时间序列模型预测批发价格，最后分析公式求得最优利润。

## 模型建立

- 数据预处理与清洗

  1. 计算利润+计算加成率
  2. 3sigma异常值处理

- 各蔬菜品类的销售总量与成本加成定价的关系

  1. 对于每个类进行建立单独的ADF检验
  2. 寻找最优滞后阶数
  3. 对于每个类进行建立单独的VAR向量自回归模型,得出各蔬菜品类的销售总量与成本加成定价的关系
  4. VAR模型稳定性检验

- 关于蔬菜品类未来一周的补货总量与定价的关系

  - 先进行因果检验
    1. ADF检验确认各时间序列均是平稳序列(避免伪回归)
    2. 使用之前的每类的最优滞后阶数(通过对FPE、AIC、SC、HQ的指标进行评价)
    3. 格兰杰因果检验变量之间是否存在因果关系(证明销量(千克)可以引起销售单价(元/千克)变化)
  - 尝试建立回归模型
    - 模型建立 - 建立多元线性回归模型
      - $$售价=a*销售量+b*批发价+c$$
      - $$s=A*+B*p+C\space\space\space\space\space\space\space\space(1)$$
    - 评估
      - F检验的结果分析可以得到，P值显著，拒绝回归系数为0的假设，因此多元线性回归模型基本满足要求。
      - 对于变量共线性表现，VIF严格小于5，没有多重共线性问题，模型构建良好。
    - 不足
      - 使用最小二乘法建立多元线性回归模型，求解参数未被约束，可能不利于后续最优利润的求解
    - 改进
      - 使用线性规划模型对求解的参数进行约束
  - 线性规划模型
    - 用带约束的线性规划模型求解出多元线性回归模型的最优参数
    - 通过$R^2$的求解，$R^2$普遍在0.9以上，全部在0.8以上模型的拟合效果良好
  - 时间序列ARIMA预测批发价
    1. 查看差分前后数据对比图，上下波动幅度不大，同时对时间序列进行偏（自相关分析），根据截尾情况估算其p、q值。
    2. ARIMA模型要求模型具备纯随机性，即模型残差为白噪声，查看模型检验表，根据Q统计量的P值(P>0.05)对模型白噪声进行检验，AIC和BIC值较低。
  - 未来一周定价策略与日补货总量
    - 利润公式
      - $$利润=销量*(售价-批发)$$
      - $$w=x*(s-p)\space\space\space\space\space\space\space\space(2)$$
    - 联立公式(1)(2),即可得到一个一元二次方程:
      - $$w=ax^2+(b-1)px+cx\space\space\space\space\space\space\space\space(满足a<0且b>1)$$ 
        显然当且仅当$x=\frac{1-b}{2a}p$有w最大值
